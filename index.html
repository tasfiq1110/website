<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arcane Mirage Player - Vector Integration</title>
    <script defer src="https://embed.arcanemirage.com/65736464-4833-43ac-8d90-8a6924907b05/e"></script>
</head>
<body style="margin: 0; text-align: center;">

    <h2>Arcane Mirage Player - Vector Data</h2>
    <p id="status">Waiting for Arcane Mirage to load...</p>

    <div id="am-container" style="width: 640px; height: 480px; margin: auto; border: 1px solid black;">
        <div id="arcane-player"
            data-project-id="5558"
            data-project-key="65736464-4833-43ac-8d90-8a6924907b05"
            data-token="grHzyZLFVx9U"
            data-enable-events-passthrough="true">
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("ðŸ“¢ Script Loaded: Waiting for Arcane Mirage Player Ready Event...");

            // Extract URL Parameters
            const urlParams = new URLSearchParams(window.location.search);
            const vectorParam = urlParams.get("vector");

            if (vectorParam) {
                console.log("âœ… Extracted Vector Parameter:", vectorParam);
                // Format the vector as a proper string for Unreal Engine
                let cleanedVector = vectorParam.replace(/[\(\)]/g, '').split(',');
                let vectorValues = cleanedVector.map(item => parseFloat(item.split('=')[1].trim()));  // Getting the X, Y, Z values

                console.log("âœ… Cleaned Vector:", vectorValues);  // [X, Y, Z]

                // You can now pass this vector to Unreal Engine.
                // The event and data to be sent
                let vectorData = {
                    event: "CustomUIEvent",
                    data: {
                        value: {
                            x: vectorValues[0],
                            y: vectorValues[1],
                            z: vectorValues[2]
                        }
                    }
                };

                console.log("ðŸ“¤ Sending vector data to Unreal Engine:", vectorData);
                // Send the extracted vector data to Unreal Engine
                if (window.ArcanePlayer) {
                    window.ArcanePlayer.emitUIEvent(vectorData);
                }
            } else {
                console.warn("âš ï¸ No vector parameter found in URL.");
            }

            // Wait for Arcane Mirage to initialize
            function waitForArcanePlayer() {
                if (window.ArcanePlayer) {
                    console.log("âœ… ArcanePlayer Exists. Waiting for 'ready' event...");

                    // Listen for "ready" event
                    window.ArcanePlayer.onPlayerEvent("ready", () => {
                        console.log("âœ… Arcane Mirage Player is fully loaded! Now sending vector data to Unreal...");
                        document.getElementById("status").innerText = "Arcane Mirage is Ready.";
                    });

                    // Listen for Unreal Engine's response
                    window.ArcanePlayer.onReceiveEvent("CustomUIEventResponse", (response) => {
                        console.log("ðŸ”„ Response from Unreal Engine:", response);
                        document.getElementById("status").innerText = "Response from UE: " + response;
                    });

                } else {
                    setTimeout(waitForArcanePlayer, 500);
                }
            }
            waitForArcanePlayer();
        });
    </script>

</body>
</html>
